<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166813491-1"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		  gtag('config', 'UA-166813491-1');
		</script>
		<title>John Mai - Electric Longboard v2</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<!-- Note: The "styleN" class below should match that of the banner element. -->
					<header id="header" class="alt style2">
						<a href="../index.html" class="logo"><strong>John Mai</strong></a>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
							<li><a href="index.html">Home</a></li>
							<li><a href="landing.html">Landing</a></li>
							<li><a href="generic.html">Generic</a></li>
							<li><a href="elements.html">Elements</a></li>
						</ul>
						<ul class="actions stacked">
							<li><a href="#" class="button primary fit">Get Started</a></li>
							<li><a href="#" class="button fit">Log In</a></li>
						</ul>
					</nav>

				<!-- Banner -->
				<!-- Note: The "styleN" class below should match that of the header element. -->
					<section id="banner" class="style2">
						<div class="inner">
							<span class="image">
								<img src="../images/ELPv2/banner.jpg" alt="" />
							</span>
							<header class="major">
								<h1>Electric Longboard - v2</h1>
							</header>
							<div class="content">
								<p>An upgrade to the original last mile transportation solution</p>
							</div>
						</div>
					</section>

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">
								<div class="inner">
									<header class="major">
										<h2>The upgrade</h2>
									</header>
									<p>Two years after the construction of the <a href="./ELPv1.html">first electric longboard</a>, I was preparing to travel to the US again to begin my masters program. Thus I decided it was time for an upgrade, using what I had learned from the first build to create an even better design. The new board features 4x the power of the previous board (1kw -> 4kW peak), increased range, fewer maintenance needs, and better comfort & rideability, all while still being portable enough to fit in a suitcase and take with me on public transit.</p>
								</div>
							</section>

						<!-- Two -->
							<section id="two" class="spotlights">
								<section>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180322_215416.jpg" alt="" data-position="center center" />
										<figcaption>Fig 1: New deck with M5 threaded inserts</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180603_123425.jpg" alt="" data-position="center center" />
										<figcaption>Fig 4: Chopping the new board in half</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180603_161026.jpg" alt="" data-position="center center" />
										<figcaption>Fig 5: A hinge in installed between the halves with angle iron supports</figcaption>
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>Construction</h3>
											</header>
											<p>Aluminium looked cool in the v1 board, but it was way too stiff and just transferred all road vibrations straight into the rider. For the new board I wanted something with a bit more flex; I went with a 38" maple/bamboo deck that I got from a wholesale manufacturer. A bit pricier than some bits of scrap aluminum, but I didn't have to shape and build it myself, and as far as longboard decks go it was quite affordable. This is important considering what I did with it when I realised it wouldn't fit in my suitcase.</p>
											<p>I put four M5 threaded inserts into the deck to hold the enclosure enclosing the electrics. This required a 3D printed template which used the pre-drilled mounting holes for the trucks as a reference point, since the board had no straight or level edges.</p>
											<p>For the enclosure that housed the electronics, I wanted something durable and waterproof. I opted for a case 3D printed in ABS, reinforced with carbon fibre. This had to be printed in two parts, as it was too big to be done in one piece on my printer. The halves were chemically welded together with acetone, and the whole part was reinforced with a carbon fibre wet layup. Brass threaded inserts were heated and pushed into holes in the ABS case, to fasten the top lid on.</br>
											The case has a stainless steel undertray and is capped on the upper side with an acrylic plate. Stainless steel was chosen over plastic or aluminium for its toughness and hardness, making it more resistant to impacts and abrasion (aluminium grinds away like butter on asphalt at high speed). It was also chosen over mild steel for its corrosion resistance. Acrylic was chosen for the upper lid (the side facing the rider), since its transparancy to radio waves allows the radio transceivers to be mounted inside the case- plus I could get a sheet of it perfectly cut out with bolt holes by a laser cutter. The undertray is fixed in place with screws and epoxy, while the upper tray is held on with screws and a foam gasket to seal out water and dust.</p>
											<p>An issue with using this deck was that it was too long to fit in my suitcase. To solve this issue, I chopped it in half and used a hinge and angle iron to join the halves together, making the longboard foldable. The deck is curved across its width, so neoprene sheeting is used as a washer between the angle iron and the deck. A stopper also made of neoprene rubber sits in the pinch point of the hinge, absorbing the impact when the board is snapped flat.</p>
										</div>
									</div>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180320_153121.jpg" alt="" data-position="center center" />
										<figcaption>Fig 2: 3D printed ABS side walls for the enclosure</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180331_150636.jpg" alt="" data-position="center center" />
										<figcaption>Fig 3: Wet layup of carbon fibre on the ABS case sidewalls</figcaption>
									</a>
								</section>
								
								
								<section>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180330_133800.jpg" alt="" data-position="center center" />
										<figcaption>Fig 5: 3D printed tool for slowly lowering the rotor shell onto the stator core</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180318_134637.jpg" alt="" data-position="center center" />
										<figcaption>Fig 7: Retrofitting hall effect sensors onto the stator core</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180425_170904.jpg" alt="" data-position="center center" />
										<figcaption>Fig 9: Cooling fans pipe air through the hub motors</figcaption>
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>Powertrain</h3>
											</header>
											<p>This build is centred around a dual hub motor powertrain, using prototype custom motors sourced from a builder experimenting with motor design for electric longboards. This setup comes with a few exciting advantages over my v1 board:</p>
											<ul style="margin-top:-30px;">
											  <li>Way more the power; about 4 times as much. This will mean much greater acceleration and braking force, making for better performance up and down hills.</li>
											  <li>Lower transmission losses than a belt-pulley setup</li>
											  <li>No more worrying about belts slipping on pulleys</li>
											  <li>Less maintenance; belts and pulleys were basically considered to be consumable items in the v1 board, needing replacement every couple hundred kilometres</li>
											  <li>No custom motor mount required</li>
											  <li>The motors are hidden in the wheels, so greater ground clearance over bumps and obstacles</li>
											</ul>
											<p>That said, there are some challenges that need to be tackled that didn't arise on the original design:</p>
											<ul style="margin-top:-30px;">
											  <li>More difficult to disassemble for maintenance</li>
											  <li>No gear reduction, so the motors draw higher currents on startup leading to larger electrical losses</li>
											  <li>Less airflow over the motors; they're basically insulated by rubber tyres</li>
											</ul>
											<p>The difficulty in maintenance was due to the way these motors are installed. Each motor has two main parts: The internal stator core has a blind hole and threads cut inside it, and is screwed onto the truck with loctite to prevent them coming loose during operation (See Figures 4 & 6 in the top left). The 2nd part is the rotor (Figure 8 in the bottom left), an outer shell of the motor containing permanent magnets. This can be removed while the stator cores are still bolted on the longboard. Assembly of the two parts requires a tool to slowly lower the rotor onto the stator, otherwise the powerful magnets just slam onto the stator laminations, possibly causing damage. I designed and 3D printed a jig shown in Figure 5 (top right) to do this, by bolting onto the rotor shell and using a bolt to slowly lower it on.</br>
											To minimise maintenance, the two metal shielded bearings on each motor were replaced with grease-filled rubber seal bearings (Figure 6, to the left).</p>
											<p>A minor issue that the v1 board had was poor performance from standstill, since there is no feedback for the motor controller to determine the motor's orientation and it has to revert to an open-loop control policy. This is solved in the new board thanks to three hall effect sensors retrofitted inside the motors, spaced 120° apart mechanically. These sense the magnetic fields of the rotor magnets and allow the controller to determine motor orientation, which in turn allows the controller to apply full power from a standstill. While these are essential for low-speed performance, they are ignored once the motors exceed around 100 RPM. After this point the observer in the control loop takes over, as it tracks more accurately at high speed. The end result of having sensored motors is insane torque from standstill- enough to throw a rider off the board.</p>
											<p>An issue that this new board faces not encountered on the previous version is overheating of the motors. This is largely due to double the peak power being dumped into each of these motors (~2kW peak vs ~1kW peak) on top of the thermally insulative rubber tyre sleeves. At these power levels, the motors hit 90°C in under a minute on flat ground, after which power has to be backed off to a crawl. In order to solve this issue with the minimum amount of additional weight, I added two centrifugal fans to the longboard deck, which pump air through flexible pipes directly into the motor core (see Figure 9 in the bottom right). The fans run at 12V from a step-down DC-DC converter from the main battery, and feed into flexible pipes through 3D printed couplings (the flexible pipes are necessary as the trucks move a significant amount while riding). Finally the air enters holes in the end of the motor through another 3D printed coupling, and pass directly over the motor windings. With the active cooling on, the overheating issue is completely solved for normal riding on flat ground, and the new board actually performs better than the previous board under sustained high load going uphill.</p>
										</div>
									</div>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180329_231833.jpg" alt="" data-position="center center" />
										<figcaption>Fig 4: Stator cores of hub motors shown on the longboard trucks (without bearings)</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180330_104806.jpg" alt="" data-position="center center" />
										<figcaption>Fig 6: Disassembled hubmotor shown with its two bearings</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180325_175307.jpg" alt="" data-position="center center" />
										<figcaption>Fig 8: Outer rotor containing magnets. The bolt inside is from the tool used to slowly lower it onto the stator.</figcaption>
									</a>
								</section>
								
								
								<section>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180615_222147.jpg" alt="" data-position="center center" />
										<figcaption>Fig 10: Layout of electrical components in enclosure</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180706_232728.jpg" alt="" data-position="center center" />
										<figcaption>Fig 12: Remote displaying telemetry data on OLED screen</figcaption>
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>Electrical</h3>
											</header>
											<p>The electrical system on the new board is very similar to the previous board, since it was tested for over 6 months and worked without any issues. With two motors though, everything was essentially just doubled.</p>
											<p>For batteries, I used two 6S 5000mAh lipo packs in series, (44.4V nominal overall) each rated at 20C (100A continuous draw). Two <a href="http://vedder.se/2015/01/vesc-open-source-esc/">VESC motor controllers</a> connect to this, each set to draw a maximum of 50A continuous from the battery. NTC thermistors mounted near the motor driver FETs and inside the hub motors monitor temperature, backing off the drive power linearly after temperature exceeds 70°C, killing power completely at 90°C. Regenerative braking is enabled up to 100°C, to ensure some braking capacity is still available even after the motors or controllers have reached the temperature cut-off.</p>
											<p>The overall input capacitance of the controllers on this board is significantly higher to account for the dual motor setup with 4 times the drive power. The soft-start feature was carried over from the previous version, and reduces inrush current when powering on the board.</p>
											<p>The board uses Bluetooth 4.0 again, this time having no issues passing through the wooden deck. This allows me to pair the old remote with this new board. The remote communicates via a UART interface over the Bluetooth connection with one of the motor controllers. This motor controller acts as a master, communicating with the slave motor controller over a CAN bus interface, sharing diagnostics and commands. Using this method, the board is able to sense wheel slip in one of the wheels by comparing the two measured wheelspeeds, and can reduce speed in the slipping wheel to maintain traction.</br>
											The slave motor controller has its own UART interface and Bluetooth module, and communicates with a second remote which displays diagnostic data in real-time on an OLED screen; speed, instantaneous current draw, estimated per-cell voltage, total current drawn over time, distance travelled, and motor & FET temperatures for all motors and controllers are all shown. In the future, I plan to combine the two remotes into one for convenience.</p>
											<p>Here's a video from one of the initial test rides, going backwards to film the drive wheels. Notice that the trucks wobble, indicating unsmooth torque. After some debugging, I concluded that this was likely due to <a href="https://ieeexplore.ieee.org/document/6063963">saturation of the motor core</a> affecting the observer's prediction of motor orientation. This is only a problem at low speeds, e.g. under heavy acceleration, when the motors draw the commanded maximum current, so I was able to alleviate the issue by tuning the observer gain and relying on the hall effect sensors until past the speed region where this is an issue.</p>
											<p align="center"><iframe width="350" height="560" src="https://www.youtube.com/embed/elaOJsssGO0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
										</div>
									</div>
									<a class="image">
										<img src="../images/ELPv2/IMG_20180414_120333.jpg" alt="" data-position="center center" />
										<figcaption>Fig 11: WIP shot of the electronics without batteries</figcaption>
										</br>
										<img src="../images/ELPv2/IMG_20180326_140952.jpg" alt="" data-position="center center" />
										<figcaption>Fig 13: Hall effect sensors are connected with thin silicone insulated wires passed through holes in the stator core</figcaption>
									</a>
								</section>
						
							</section>

						<!-- Three -->
							<section id="three">
								<div class="inner">
									<header class="major">
										<h2>Conclusion</h2>
									</header>
									<p>While this longboard hasn't had the same lifetime mileage as the previous one, I'm quite happy with how it turned out. It has more than enough power, being able to throw a rider off under full acceleration, and I'd consider any more power to be unnecessary. Peak speed on this board is about 40km/h, about the highest I'm comfortable with travelling standing on a plank of wood. The active cooling works very well; it could be a little quieter but it can't be heard over the road noise of the board anyway. A range of 10-25 km is fine for a day's worth of riding between bus stops and train stations, and while longer range is always welcome, I think the current setup strikes a good balance between weight and range. With a high power charger, the board can be quick charged in under an hour from a standard wall outlet anyway. Retrofitting the motors with sensors turned out to be very useful, not only for starting from stationary, but to also circumvent the stator saturation issues under heavy acceleration. It's a very nice feature to have, and gives a rider much more confidence in the board's response over a sensorless setup. The whole board weighs 7kg, so 2kg more than the original, but that's with double the batteries, motors, and electronics. It's still manageable though, and I can carry it with me by a handle on the hinge onto public transport with no problem.</p>
									<p>Here's the first time the full board was tested; note that without any weight on it, the drive wheels tend to just slip.</p>
									<p align="center"><iframe width="500" height="600" src="https://www.youtube.com/embed/33ff8MfyYO8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
								</div>
							</section>

					</div>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<ul class="icons">
								<li><a href="https://www.linkedin.com/in/john-mai-641a73b5/" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							</ul>
						</div>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>

	</body>
</html>
